services:
  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: open-webui
    restart: always
    ports:
      - "3000:8080"
    volumes:
      - open-webui:/app/backend/data
      - /home/support/mcp/mcp_config.json:/app/backend/data/mcp_config.json:ro
      - /home/support/variable/mstr.txt:/run/secrets/mstr_password:ro
    environment:
      - DATA_DIR=/app/backend/data
      - MSTR_PASSWORD_FILE=/run/secrets/mstr_password
      - WEBUI_SECRET_KEY=f355b0573904fdee3ea09b9054ce5c184a6fdfe6fb1c31d7de9666e45a0aae7e
      - TZ=America/New_York
    networks:
      - mcp-net

  mcpo:
    image: ghcr.io/open-webui/mcpo:main
    container_name: mcpo
    restart: always
    ports:
      - "8001:8000"
    environment:
      - TZ=America/New_York
      - MCPO_DATABASE_URL=sqlite:////app/data/mcpo.db
    volumes:
      # Main Config
      - /home/support/mcp/mcp_config.json:/app/config.json:ro
      - /home/support/variable/mstr.txt:/run/secrets/mstr_password:ro
      - mcpo-data:/app/data
      # Local MCP Server Mounts (bypasses container NPM registry)
      - /home/support/mcp/n8n-server:/app/n8n-server:ro
      - /home/support/mcp/mcp-servers/src/ssh:/app/ssh-server:ro
    # Explicitly point to the config file
    command: mcpo --host 0.0.0.0 --port 8000 --config /app/config.json
    networks:
      - mcp-net

networks:
  mcp-net:
    driver: bridge

volumes:
  open-webui:
  mcpo-data:
